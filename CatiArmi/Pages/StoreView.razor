@page "/Store"
@using CatiArmi.Components
@using CatiArmi.Scripts;
@inject NavigationManager NavigationManager

<Animate Auto Animation="PageAnimationManager.NextPageAnimation">
     <Container TextAlignment="TextAlignment.Center" Background="Background.Light">
         @* Header *@
         <Row Padding="Padding.Is2">
             <Column ColumnSize="ColumnSize.Is2">
                 <Div Class="clicky-card-link" onclick="@NavigateToHordeView">
                     <Card Padding="Padding.Is2" Margin="Margin.Is1">
                         <CardBody>
                             <Text TextSize="TextSize.ExtraLarge">🔙</Text>
                         </CardBody>
                     </Card>
                 </Div>
             </Column>
             <Column ColumnSize="ColumnSize.Is10">
                 <Div Padding="Padding.Is2" />
                 <Text TextSize="TextSize.Heading1" Padding="Padding.Is2">@StoreManager.CurStore.Name</Text>
             </Column>
             <Column ColumnSize="ColumnSize.Is2" />
         </Row>

         @* Body *@
         <Row>
             <Column ColumnSize="ColumnSize.Is8" Height="Height.Rem(37)">
                 <Image Source="placeholders/Chopper.png" VerticalAlignment="VerticalAlignment.Bottom" />
             </Column>
             <Column ColumnSize="ColumnSize.Is4">
                 <Container TextAlignment="TextAlignment.Center" Padding="Padding.Is2">
                     @* Resources *@
                     <ResourcesPanel />

                     <Div Padding="Padding.Is2" />

                     @* ShopWindow *@
                     <ShopWindow Store="@StoreManager.CurStore" />
                 </Container>
             </Column>
         </Row>

         @* Dialog Box *@
         <Row Padding="Padding.Is4" Background="Background.Light">
             <Card Height="Height.Rem(15)">
                 <CardBody style="display: grid; align-items: center;">
                     <Text VerticalAlignment="VerticalAlignment.Middle" TextSize="TextSize.ExtraLarge">
                         @StoreManager.CurStore.CurSpeech
                     </Text>
                 </CardBody>
             </Card>
         </Row>
     </Container>
 </Animate>

 @code {
    protected override void OnInitialized()
    {
        Task.Run(async () =>
        {
            await Task.Delay(100);
            PageAnimationManager.NextPageAnimation = Animations.Fade;
        });
    }

    public StoreView()
    {
        StoreManager.InvokeSpeechEnteredStore();

        StoreManager.StoreRefresh += StateHasChanged;
    }

    void NavigateToHordeView()
    {
        GameManager.InitializeTimers();

        PageAnimationManager.NextPageAnimation = Animations.FadeRight;
        NavigationManager.NavigateTo("Horde");

        AudioManager.PlaySound("transitionToHorde");
    }
}