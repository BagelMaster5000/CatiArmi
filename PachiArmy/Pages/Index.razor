@page "/"
@using PachiArmy.Scripts;
@using PachiArmy.Components;
@using System.Timers;

<HordeView Items="Placeables">
    <TestBody Context="placeable">
        <BoardPlaceable Placeable=placeable></BoardPlaceable>
    </TestBody>
</HordeView>

@code {
    public List<Placeable> Placeables = BoardManager.ActivePlaceables;

    private void IncrementCount()
    {
        foreach (Pachimari p in Placeables)
        {
            p.test++;
        }
    }

    public System.Timers.Timer timer;
    protected override async Task OnInitializedAsync()
    {
        for (uint i = 0; i < 5; i++)
        {
            var pachi = new Pachimari();
            BoardManager.TryFindOpenSpaceAndPlacePlaceable(pachi);
        }
        var foodbowl = new FoodBowl();
        BoardManager.TryFindOpenSpaceAndPlacePlaceable(foodbowl);
        var waterBowl = new WaterBowl();
        BoardManager.TryFindOpenSpaceAndPlacePlaceable(waterBowl);
        var toy = new Toy();
        BoardManager.TryFindOpenSpaceAndPlacePlaceable(toy);
        var snack = new Snack();
        BoardManager.TryFindOpenSpaceAndPlacePlaceable(snack);

        timer = new Timer(1000);
        timer.Elapsed += this.OnTimedEvent;
        timer.AutoReset = true;
        timer.Enabled = true;
        timer.Start();
    }

    public void OnTimedEvent(Object source, ElapsedEventArgs e)
    {
        IncrementCount();
        StateHasChanged();
    }
}