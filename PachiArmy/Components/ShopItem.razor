@using PachiArmy.Scripts;

<Div Padding="Padding.Is1">
    <Div Class="@GetShopItemClass()" onclick="@TryPurchaseWrapper">
        <Card Padding="Padding.Is2" Margin="Margin.Is1" Width="Width.Max100">
            <Container>
                <Span>
                    <Image Source="@Item.Icon" Width="Width.Rem(3)" />
                    <Text Padding="Padding.Is2" VerticalAlignment="VerticalAlignment.Middle">@Item.Name  $@Item.Price</Text>
                </Span>
            </Container>
        </Card>
    </Div>
</Div>

@code {
    [Parameter]
    public StoreItem Item { get; set; } = default!;

    protected override void OnInitialized()
    {
        Inventory.ResourcesUpdated += StateHasChanged;
    }

    string GetShopItemClass()
    {
        if (Item.OutOfStock)
        {
            return "store-item-outofstock";
        }

        else
        {
            return Item.CanPurchase() ? "store-item" : "store-item-disabled";
        }
    }

    void TryPurchaseWrapper()
    {
        Item.TryPurchase();

        Inventory.InvokeResourcesUpdated();
    }
}